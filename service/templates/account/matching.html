{% extends "base.html" %} 
{% block content %} 

<div class="row">
	<div class="col span-12">
	<div class="cms">
		<h1>Matching History</h1>
	</div>
	
	<div class="row">
		<form class="form" action="" method="GET">
			<div class="col span-6">

				<ul class="form-fields">
					<li class="form-fields__item--text"><label> <span
							class="form-fields__label-text">Show history until:</span> <input type="text"
							name="since" value="{{date}}">
					</label>
					<button class="btn btn--3d btn--primary move-up" type="submit">Send</button>
					</li>
				</ul>


			</div>
			<div class="col span-5">
			</div>
		</form>
	
	</div>	
		<div class="col span-12">{% from
			"harvester/helpers/pagination.html" import render_pagination%} {{
			render_pagination(num_of_pages,page_num,link) }}</div>

			
			<table id="publisherTable">
				<tr>
					<th>Analysis&nbsp;Date</th>
					<th>ISSN&nbsp;or&nbsp;EISSN</th>
					<th>DOI</th>
					<th>License</th>
					<th>Forwarded&nbsp;to</th>
					<th>Term</th>
					<th>Appears&nbsp;in</th>
				</tr>

			</table>
				
			{% from "harvester/helpers/pagination.html" import render_pagination%}
		{{ render_pagination(num_of_pages,page_num,link) }}
		<div class="row">
			<div class="col span-1"></div>
			<div class="col span-1"></div>
			<div class="col span-1"></div>
		</div>

		<div id='elem'></div>
	</div>	
	</div>

		
		


<script>
	var obj = JSON.parse ({{ repo|tojson|safe }}); 

	// var node = '';

	for (variable in obj.matches) {
		var prov = obj.matches[variable].provenance;
		var bibid = obj.matches[variable].repo;
		var issn = 'n/a';
		var doi = 'n/a';
		var link = 'n/a';
                if ('alliance' in obj.matches[variable]) {
			issn = obj.matches[variable].alliance.issn;
			doi = obj.matches[variable].alliance.doi;
			link = obj.matches[variable].alliance.link;
		}
		if ('bibid' in obj.matches[variable]) {
			bibid = obj.matches[variable].bibid;
		}
		$('#publisherTable tr:last').after('<tr>\
			<td>'+obj.matches[variable].created_date+'</td> \
			<td>'+issn+'</td> \
			<td>'+doi+'</td> \
			<td>'+link+'</td> \
			<td>'+bibid+'</td> \
			<td>'+prov[0].term+'</td> \
			<td>'+prov[0].notification_field+'</td> \
		</tr>');
	//node[id] = new PrettyJSON.view.Node({
	//	el : $('#'+id),
	//	data : obj.matches[variable]
	// });
	}
</script>


{% endblock %}
