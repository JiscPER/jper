<?xml version="1.0" encoding="ascii"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>service.routing</title>
  <link rel="stylesheet" href="epydoc.css" type="text/css" />
  <script type="text/javascript" src="epydoc.js"></script>
</head>

<body bgcolor="white" text="black" link="blue" vlink="#204080"
      alink="#204080">
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="https://github.com/JiscPER/jper">Jisc Publications Router</a></th>
          </tr></table></th>
  </tr>
</table>
<table width="100%" cellpadding="0" cellspacing="0">
  <tr valign="top">
    <td width="100%">
      <span class="breadcrumbs">
        <a href="service-module.html">Package&nbsp;service</a> ::
        Module&nbsp;routing
      </span>
    </td>
    <td>
      <table cellpadding="0" cellspacing="0">
        <!-- hide/show private -->
        <tr><td align="right"><span class="options">[<a href="javascript:void(0);" class="privatelink"
    onclick="toggle_private();">hide&nbsp;private</a>]</span></td></tr>
        <tr><td align="right"><span class="options"
            >[<a href="frames.html" target="_top">frames</a
            >]&nbsp;|&nbsp;<a href="service.routing-module.html"
            target="_top">no&nbsp;frames</a>]</span></td></tr>
      </table>
    </td>
  </tr>
</table>
<!-- ==================== MODULE DESCRIPTION ==================== -->
<h1 class="epydoc">Module routing</h1><p class="nomargin-top"><span class="codelink"><a href="service.routing-pysrc.html">source&nbsp;code</a></span></p>
Module which handles all the routing mechanics to convert UnroutedNotifications into either
RoutedNotifications or FailedNotifications

<!-- ==================== CLASSES ==================== -->
<a name="section-Classes"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Classes</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-Classes"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
        <a href="service.routing.RoutingException-class.html" class="summary-name">RoutingException</a><br />
      Generic exception to be raised when errors with routing are encountered
    </td>
  </tr>
</table>
<!-- ==================== FUNCTIONS ==================== -->
<a name="section-Functions"></a>
<table class="summary" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Functions</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-Functions"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="service.routing-module.html#route" class="summary-sig-name">route</a>(<span class="summary-sig-arg">unrouted</span>)</span><br />
      Route an UnroutedNotification to the appropriate repositories</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="service.routing-pysrc.html#route">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="service.routing-module.html#match" class="summary-sig-name">match</a>(<span class="summary-sig-arg">notification_data</span>,
        <span class="summary-sig-arg">repository_config</span>,
        <span class="summary-sig-arg">provenance</span>)</span><br />
      Match the incoming notification data, to the repository config and determine
if there is a match.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="service.routing-pysrc.html#match">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="service.routing-module.html#enhance" class="summary-sig-name">enhance</a>(<span class="summary-sig-arg">routed</span>,
        <span class="summary-sig-arg">metadata</span>)</span><br />
      Enhance the routed notification with the extracted metadata</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="service.routing-pysrc.html#enhance">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="service.routing-module.html#_merge_entities" class="summary-sig-name" onclick="show_private();">_merge_entities</a>(<span class="summary-sig-arg">e1</span>,
        <span class="summary-sig-arg">e2</span>,
        <span class="summary-sig-arg">primary_property</span>,
        <span class="summary-sig-arg">other_properties</span>=<span class="summary-sig-default">None</span>)</span><br />
      Merge dict objects e1 and e2 so that the resulting dict has the data from both.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="service.routing-pysrc.html#_merge_entities">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="service.routing-module.html#repackage" class="summary-sig-name">repackage</a>(<span class="summary-sig-arg">unrouted</span>,
        <span class="summary-sig-arg">repo_ids</span>)</span><br />
      Repackage any binary content associated with the notification for consumption by
the repositories identified by the list of repo_ids.</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="service.routing-pysrc.html#repackage">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a name="links"></a><span class="summary-sig-name">links</span>(<span class="summary-sig-arg">routed</span>)</span></td>
          <td align="right" valign="top">
            <span class="codelink"><a href="service.routing-pysrc.html#links">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="service.routing-module.html#domain_url" class="summary-sig-name">domain_url</a>(<span class="summary-sig-arg">domain</span>,
        <span class="summary-sig-arg">url</span>)</span><br />
      normalise the domain: strip prefixes and URL paths.  If either ends with the other, it is a match</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="service.routing-pysrc.html#domain_url">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="service.routing-module.html#domain_email" class="summary-sig-name">domain_email</a>(<span class="summary-sig-arg">domain</span>,
        <span class="summary-sig-arg">email</span>)</span><br />
      normalise the domain: strip prefixes an URL paths.  Normalise the email: strip everything before &#64;.  If either ends with the other it is a match</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="service.routing-pysrc.html#domain_email">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="service.routing-module.html#author_match" class="summary-sig-name">author_match</a>(<span class="summary-sig-arg">author_obj_1</span>,
        <span class="summary-sig-arg">author_obj_2</span>)</span><br />
      Match two author objects against eachother</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="service.routing-pysrc.html#author_match">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="service.routing-module.html#author_string_match" class="summary-sig-name">author_string_match</a>(<span class="summary-sig-arg">author_string</span>,
        <span class="summary-sig-arg">author_obj</span>)</span><br />
      Match an arbitrary string against the id in the author object</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="service.routing-pysrc.html#author_string_match">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="service.routing-module.html#postcode_match" class="summary-sig-name">postcode_match</a>(<span class="summary-sig-arg">pc1</span>,
        <span class="summary-sig-arg">pc2</span>)</span><br />
      Normalise postcodes: strip whitespace and lowercase, then exact match required</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="service.routing-pysrc.html#postcode_match">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="service.routing-module.html#exact_substring" class="summary-sig-name">exact_substring</a>(<span class="summary-sig-arg">s1</span>,
        <span class="summary-sig-arg">s2</span>)</span><br />
      normalised s1 must be an exact substring of normalised s2</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="service.routing-pysrc.html#exact_substring">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="service.routing-module.html#exact" class="summary-sig-name">exact</a>(<span class="summary-sig-arg">s1</span>,
        <span class="summary-sig-arg">s2</span>)</span><br />
      normalised s1 must be identical to normalised s2</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="service.routing-pysrc.html#exact">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr class="private">
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="service.routing-module.html#_normalise" class="summary-sig-name" onclick="show_private();">_normalise</a>(<span class="summary-sig-arg">s</span>)</span><br />
      Normalise the supplied string in the following ways:</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="service.routing-pysrc.html#_normalise">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
<tr>
    <td width="15%" align="right" valign="top" class="summary">
      <span class="summary-type">&nbsp;</span>
    </td><td class="summary">
      <table width="100%" cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td><span class="summary-sig"><a href="service.routing-module.html#author_id_string" class="summary-sig-name">author_id_string</a>(<span class="summary-sig-arg">aob</span>)</span><br />
      Produce a string representation of an author id</td>
          <td align="right" valign="top">
            <span class="codelink"><a href="service.routing-pysrc.html#author_id_string">source&nbsp;code</a></span>
            
          </td>
        </tr>
      </table>
      
    </td>
  </tr>
</table>
<!-- ==================== FUNCTION DETAILS ==================== -->
<a name="section-FunctionDetails"></a>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr bgcolor="#70b0f0" class="table-header">
  <td colspan="2" class="table-header">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
      <tr valign="top">
        <td align="left"><span class="table-header">Function Details</span></td>
        <td align="right" valign="top"
         ><span class="options">[<a href="#section-FunctionDetails"
         class="privatelink" onclick="toggle_private();"
         >hide private</a>]</span></td>
      </tr>
    </table>
  </td>
</tr>
</table>
<a name="route"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">route</span>(<span class="sig-arg">unrouted</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="service.routing-pysrc.html#route">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Route an UnroutedNotification to the appropriate repositories</p>
<p>The function will extract all the metadata and match data from any binary content associated with
the notification, and in combination from match data taken from the notification metadata itself will
determine if there is a RepositoryConfig whose criteria it matches.</p>
<p>If there is a match to one or more of the criteria, MatchProvenance objects will be created for
each matching repository, and persisted for later inspection.</p>
<p>If one or more repositories are matched, a RoutedNotification will be created and enhanced with any
metadata extracted from the associated package (if present), then persisted.</p>
<p>If no repositories match, a FailedNotification will be created and enhanced with any
metadata extracted from the associated package (if present), then persisted.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>unrouted</code></strong> - an UnroutedNotification object</li>
    </ul></dd>
    <dt>Returns:</dt>
        <dd>True if the notification was routed to a repository, False if there were no matches</dd>
  </dl>
</td></tr></table>
</div>
<a name="match"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">match</span>(<span class="sig-arg">notification_data</span>,
        <span class="sig-arg">repository_config</span>,
        <span class="sig-arg">provenance</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="service.routing-pysrc.html#match">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Match the incoming notification data, to the repository config and determine
if there is a match.</p>
<p>If there is a match, all criteria for the match will be added to the provenance
object</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>notification_data</code></strong> - models.RoutingMetadata</li>
        <li><strong class="pname"><code>repository_config</code></strong> - models.RepositoryConfig</li>
    </ul></dd>
    <dt>Returns:</dt>
        <dd>True if there was a match, False if not</dd>
  </dl>
</td></tr></table>
</div>
<a name="enhance"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">enhance</span>(<span class="sig-arg">routed</span>,
        <span class="sig-arg">metadata</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="service.routing-pysrc.html#enhance">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  Enhance the routed notification with the extracted metadata
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>routed</code></strong> - a RoutedNotification whose metadata is to be enhanced</li>
        <li><strong class="pname"><code>metadata</code></strong> - a NotificationMetadata object</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="_merge_entities"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_merge_entities</span>(<span class="sig-arg">e1</span>,
        <span class="sig-arg">e2</span>,
        <span class="sig-arg">primary_property</span>,
        <span class="sig-arg">other_properties</span>=<span class="sig-default">None</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="service.routing-pysrc.html#_merge_entities">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Merge dict objects e1 and e2 so that the resulting dict has the data from both.</p>
<p>Entities are in-particular dicts which may contain an &quot;identifier&quot; field, such as
used by projects and authors.</p>
<p>The primary_property names the field in the dict which can be used to confirm that
e1 and e2 reference the same entity, in the event that no matching identifiers are present.</p>
<p>If no identifier is present, and the primary_property values do not match, then this merge
will not proceed.</p>
<p>The other_properties is an explicit list of the properties that should be merged to form
the final output (no need to list the primary_property)</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>e1</code></strong> - first entity object</li>
        <li><strong class="pname"><code>e2</code></strong> - second entity object</li>
        <li><strong class="pname"><code>primary_property</code></strong> - primary way to assert two entities refer to the same thing</li>
        <li><strong class="pname"><code>other_properties</code></strong> - explicit list of properties to merge</li>
    </ul></dd>
  </dl>
</td></tr></table>
</div>
<a name="repackage"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">repackage</span>(<span class="sig-arg">unrouted</span>,
        <span class="sig-arg">repo_ids</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="service.routing-pysrc.html#repackage">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Repackage any binary content associated with the notification for consumption by
the repositories identified by the list of repo_ids.</p>
<p>Note that this takes an unrouted notification, because of the point in the routing workflow at
which it is invoked, although in reality you could also pass it any of the other fully fledged
notification objects such as RoutedNotification</p>
<p>This function will check each account associated with the repository id for the package format
thats that they will accept for deposit.  For each format, we look for a route to convert from
the source format that the provider gave us for the notification, and then issue a package convert
request via the PackageManager to the best possible format for the repository.</p>
<p>For each successful conversion the notification recieves a new link attribute containing
identification information for the converted package.</p>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>unrouted</code></strong> - notification object</li>
        <li><strong class="pname"><code>repo_ids</code></strong> - list of repository account identifiers</li>
    </ul></dd>
    <dt>Returns:</dt>
        <dd>a list of the format conversions that were carried out</dd>
  </dl>
</td></tr></table>
</div>
<a name="domain_url"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">domain_url</span>(<span class="sig-arg">domain</span>,
        <span class="sig-arg">url</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="service.routing-pysrc.html#domain_url">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  normalise the domain: strip prefixes and URL paths.  If either ends with the other, it is a match
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>domain</code></strong> - domain string</li>
        <li><strong class="pname"><code>url</code></strong> - any url</li>
    </ul></dd>
    <dt>Returns:</dt>
        <dd>True if match, False if not</dd>
  </dl>
</td></tr></table>
</div>
<a name="domain_email"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">domain_email</span>(<span class="sig-arg">domain</span>,
        <span class="sig-arg">email</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="service.routing-pysrc.html#domain_email">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  normalise the domain: strip prefixes an URL paths.  Normalise the email: strip everything before &#64;.  If either ends with the other it is a match
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>domain</code></strong> - domain string</li>
        <li><strong class="pname"><code>email</code></strong> - any email address</li>
    </ul></dd>
    <dt>Returns:</dt>
        <dd>True if match, False if not</dd>
  </dl>
</td></tr></table>
</div>
<a name="author_match"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">author_match</span>(<span class="sig-arg">author_obj_1</span>,
        <span class="sig-arg">author_obj_2</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="service.routing-pysrc.html#author_match">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  Match two author objects against eachother
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>author_obj_1</code></strong> - first author object</li>
        <li><strong class="pname"><code>author_obj_2</code></strong> - second author object</li>
    </ul></dd>
    <dt>Returns:</dt>
        <dd>True if match, False if not</dd>
  </dl>
</td></tr></table>
</div>
<a name="author_string_match"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">author_string_match</span>(<span class="sig-arg">author_string</span>,
        <span class="sig-arg">author_obj</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="service.routing-pysrc.html#author_string_match">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  Match an arbitrary string against the id in the author object
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>author_string</code></strong> - an arbitrary string which may be an author id</li>
        <li><strong class="pname"><code>author_obj</code></strong> - the author object to check against</li>
    </ul></dd>
    <dt>Returns:</dt>
        <dd>True if match, False if not</dd>
  </dl>
</td></tr></table>
</div>
<a name="postcode_match"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">postcode_match</span>(<span class="sig-arg">pc1</span>,
        <span class="sig-arg">pc2</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="service.routing-pysrc.html#postcode_match">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  Normalise postcodes: strip whitespace and lowercase, then exact match required
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>pc1</code></strong> - first postcode</li>
        <li><strong class="pname"><code>pc2</code></strong> - second postcode</li>
    </ul></dd>
    <dt>Returns:</dt>
        <dd>True if match, False if not</dd>
  </dl>
</td></tr></table>
</div>
<a name="exact_substring"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">exact_substring</span>(<span class="sig-arg">s1</span>,
        <span class="sig-arg">s2</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="service.routing-pysrc.html#exact_substring">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  normalised s1 must be an exact substring of normalised s2
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>s1</code></strong> - first string</li>
        <li><strong class="pname"><code>s2</code></strong> - second string</li>
    </ul></dd>
    <dt>Returns:</dt>
        <dd>True if match, False if not</dd>
  </dl>
</td></tr></table>
</div>
<a name="exact"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">exact</span>(<span class="sig-arg">s1</span>,
        <span class="sig-arg">s2</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="service.routing-pysrc.html#exact">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  normalised s1 must be identical to normalised s2
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>s1</code></strong> - first string</li>
        <li><strong class="pname"><code>s2</code></strong> - second string</li>
    </ul></dd>
    <dt>Returns:</dt>
        <dd>True if match, False if not</dd>
  </dl>
</td></tr></table>
</div>
<a name="_normalise"></a>
<div class="private">
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">_normalise</span>(<span class="sig-arg">s</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="service.routing-pysrc.html#_normalise">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  <p>Normalise the supplied string in the following ways:</p>
<ol class="rst-arabic simple">
<li>String excess whitespace</li>
<li>cast to lower case</li>
<li>Normalise all internal spacing</li>
</ol>
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>s</code></strong> - string to be normalised</li>
    </ul></dd>
    <dt>Returns:</dt>
        <dd>normalised string</dd>
  </dl>
</td></tr></table>
</div>
<a name="author_id_string"></a>
<div>
<table class="details" border="1" cellpadding="3"
       cellspacing="0" width="100%" bgcolor="white">
<tr><td>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
  <tr valign="top"><td>
  <h3 class="epydoc"><span class="sig"><span class="sig-name">author_id_string</span>(<span class="sig-arg">aob</span>)</span>
  </h3>
  </td><td align="right" valign="top"
    ><span class="codelink"><a href="service.routing-pysrc.html#author_id_string">source&nbsp;code</a></span>&nbsp;
    </td>
  </tr></table>
  
  Produce a string representation of an author id
  <dl class="fields">
    <dt>Parameters:</dt>
    <dd><ul class="nomargin-top">
        <li><strong class="pname"><code>aob</code></strong> - author object</li>
    </ul></dd>
    <dt>Returns:</dt>
        <dd>string representation of author id</dd>
  </dl>
</td></tr></table>
</div>
<br />
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="https://github.com/JiscPER/jper">Jisc Publications Router</a></th>
          </tr></table></th>
  </tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%%">
  <tr>
    <td align="left" class="footer">
    Generated by Epydoc 3.0.1 on Tue Nov 17 09:58:18 2015
    </td>
    <td align="right" class="footer">
      <a target="mainFrame" href="http://epydoc.sourceforge.net"
        >http://epydoc.sourceforge.net</a>
    </td>
  </tr>
</table>

<script type="text/javascript">
  <!--
  // Private objects are initially displayed (because if
  // javascript is turned off then we want them to be
  // visible); but by default, we want to hide them.  So hide
  // them unless we have a cookie that says to show them.
  checkCookie();
  // -->
</script>
</body>
</html>
